<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Angular-tutorial by nickhsieh</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Angular-tutorial</h1>
      <h2 class="project-tagline">AngularJS 教學</h2>
      <a href="https://github.com/nickhsieh/angular-tutorial" class="btn">View on GitHub</a>
      <a href="https://github.com/nickhsieh/angular-tutorial/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/nickhsieh/angular-tutorial/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h3>
<a id="angular-基本介紹" class="anchor" href="#angular-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%B4%B9" aria-hidden="true"><span class="octicon octicon-link"></span></a>Angular 基本介紹.</h3>

<p>AngularJS 是一個 Javascript 的前端框架，藉著自訂 HTML Tag 或 Attribute 來擴展 HTML 的功能並建立成自己的 Component 來達到模組化。</p>

<p>另外最重要的特色為 Template 與 Model 是自動的 two-way binding，也就是異動 Model 時會自動更新 Template 上相對的欄位而反之亦然，這樣的特色得以讓工程師從 JQuery style 必須處理所有繁瑣細節中解脫，變成一次只需要專注於資料的操作或畫面的設計即可。</p>

<p>以下將開始依序介紹 AngularJS 的幾個重要功能，看完本教學後各位應該就能夠將 AngularJS 應用在各種專案中。</p>

<h3>
<a id="template-與-data-binding" class="anchor" href="#template-%E8%88%87-data-binding" aria-hidden="true"><span class="octicon octicon-link"></span></a>Template 與 Data Binding</h3>

<pre><code>&lt;div ng-app ng-init="qty=1;cost=2"&gt;
    &lt;b&gt;Invoice:&lt;/b&gt;

    &lt;div&gt;
        Quantity: &lt;input type="number" min="0" ng-model="qty"&gt;
    &lt;/div&gt;

    &lt;div&gt;
        Costs: &lt;input type="number" min="0" ng-model="cost"&gt;
    &lt;/div&gt;

    &lt;div&gt;
        &lt;b&gt;Total:&lt;/b&gt; {{qty * cost | currency}}
    &lt;/div&gt;
&lt;/div&gt;
</code></pre>

<p>這是一個基本的 Model 與 Template binding 的模式，Model 在 AngularJS 被稱為 Scope，往後的說明我們都會改用 Scope 代替 Model。
裡面所看到的所有 ng-xxx 都是 AngularJS 內建的元件，又被稱為 Directive，Directive 的詳細介紹我們留到稍後再做說明，這裡僅介紹有用到的 Directive。</p>

<p>第一個看到的是ng-app，用來標注這個 Tag 以及其子節點需要 AngularJS 幫我們控管與處理，頁面上最少會有一個ng-app。</p>

<p>ng-init 內可以執行一些基本的 script，原則上不太會使用到這個 Directive，這裡是用來初始化 model 的值。</p>

<p>再往下看會看到兩個 input 上都有 ng-model，這是重要的 Directive，任何 type 的 input 欄位加上 ng-model 後，input 的值就會和 ng-model 裡定義的 Scope 欄位名稱自動作 binding。</p>

<p>最後看到 {{ }}，這是個 Expressions，Expressions 內的語法跟 Javascript 差不多, 可以執行運算或呼叫 Function，和 Javascript 的差別為以下幾點：</p>

<ul>
<li>Context: Expressions 的 context 是 Scope，Javascript 是 window</li>
<li>Null or Undefined Value 錯誤: Expressions 內如果有欄位是 null 或 undefined 不會造成錯誤，Javascript則會丟出 Error</li>
<li>Flow Control: Expression 內無法使用任何條件判斷式、迴圈以及 try catch</li>
<li>Expressions 內無法宣告 Function，Regexp，也無法使用逗點符號以及 void</li>
<li>
<p>Expressions 可以加上 Filters 幫 結果值做額外的處理</p>

<p>{{qty * cost | currency}}</p>
</li>
</ul>

<p>這裡的 Expressions 就是把 model 內的 qty 和 cost 相乘後再交給 currency 這個 Filter 加上 $ 字號。</p>

<p>內建的 <a href="https://docs.angularjs.org/api/ng/filter">FIlter</a> 和自己建立 <a href="https://docs.angularjs.org/guide/filter">Custom Filter</a> 都相當簡單，請自行查詢，本教學不多做解釋。</p>

<p>這樣就完成了一個基本的計算功能，不需要操作 DOM 做取值與賦予值的動作，下圖是此範例的 binding 邏輯。</p>

<p><img src="https://docs.angularjs.org/img/guide/concepts-databinding1.png"></p>

<h3>
<a id="controller" class="anchor" href="#controller" aria-hidden="true"><span class="octicon octicon-link"></span></a>Controller</h3>

<pre><code>&lt;script type="text/javascript"&gt;
    var app = angular.module("myApp", [])
    app.controller("myController", ['$scope', function($scope){
        $scope.qty = 1;
        $scope.cost = 2;
    }])
&lt;/script&gt;

&lt;div ng-app="myApp" ng-controller="myController"&gt;
    &lt;b&gt;Invoice:&lt;/b&gt;

    &lt;div&gt;
        Quantity: &lt;input type="number" min="0" ng-model="qty"&gt;
    &lt;/div&gt;

    &lt;div&gt;
        Costs: &lt;input type="number" min="0" ng-model="cost"&gt;
    &lt;/div&gt;

    &lt;div&gt;
        &lt;b&gt;Total:&lt;/b&gt; {{qty * cost | currency}}
    &lt;/div&gt;
&lt;/div&gt;
</code></pre>

<p>雖然不一定要有 module 才能使用 controller，但為了方便往後程式擴展的維護，還是習慣都使用 module 比較好</p>

<p>所以首先我們給 ng-app 一個 myApp 的值，表示內容交由 myApp 這個 Module 處理</p>

<p>Module 的宣告方法如下：</p>

<pre><code>angular.module( "moduleName", [dependencies, ...])
</code></pre>

<p>請記得就算不需要 reqiure 其他 module, 第二個參數也需要給空陣列[]，如果沒有給第二個參數會變成get module，而不是 define module。</p>

<p>然後加上ng-controller，加上 ng-controller 後 Angular 會幫我們在這個 node 上建立一個 scope，稍後我們可以在 Controller 內將這個 scope inject 進來並賦予初始值。</p>

<p>Controller 的宣告方法如下：</p>

<pre><code>app.controller( "controllerName", function(serviceName, ...){
    ...
})
</code></pre>

<p>但上述方法如果有使用 ugilfy 或 closure compiler 的話 serviceName 會編譯成亂碼而找不到正確要 inject 的 service 名稱變得無法執行，所以建議用下述比較嚴謹的方法</p>

<pre><code>app.controller( "controllerName", ['serviceName', ..., function(serviceNameObj, ...){
    ...
}])
</code></pre>

<p>Angular 內建的 servie 相當多，可以自行到 <a href="https://docs.angularjs.org/api">API</a> 查詢，我們需要 inject 是 $scope 這個 service，所以把他 inject 進來</p>

<pre><code>app.controller("myController", ['$scope', function($scope){
    ...
}])
</code></pre>

<p>Controller 可以視為 constructor， 所以初始值的賦予都會寫在這裡，我們開始設定 scope 的初始值</p>

<pre><code>$scope.qty = 1;
$scope.cost = 2;
</code></pre>

<p>因為 template 和 scope 是自動的 two-way binding，template 上應該一開始就會有我們在這裡設定的值了，這樣就完成了加上 Controller的動作。</p>

<p>下面是加上 Controller 後的邏輯示意圖</p>

<p><img src="https://docs.angularjs.org/img/guide/concepts-databinding2.png"></p>

<p>注意到這個示意圖的 ng-controller 內是用 controllerName as aliasName 的形式，所以他的 Controller 宣告內沒有使用 $scope 這個 service，而是改用 Controller 本身 this 來代替，binding邏輯是一樣的，想了解這個用法的話可以 google controller as 或者是 bindToController。</p>

<p>接下來我們就可以試著把 cost 的值改成由 AJAX 的方式抓取，angular 的 AJAX service 是 $http，所以 controller 可以改成</p>

<pre><code> app.controller("myController", ['$scope', '$http', function($scope, $http){
     $scope.qty = 1;
     $scope.cost = $http.get("urlPath");
 }])
</code></pre>

<p>$http service 會回傳一個 $q 的物件，<a href="https://docs.angularjs.org/api/ng/service/%24q">$q</a> 是 Angular 內建的 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a> service，當 AJAX 的結果回傳後 scope 會自動解析出 Promise 的值並一樣會自動 binding 到 template 上。</p>

<h3>
<a id="service" class="anchor" href="#service" aria-hidden="true"><span class="octicon octicon-link"></span></a>Service</h3>

<p>我們已經使用過了 Angular 內建的 $scope 和 $http service 了，現在來了解一下 service 大概的特性與用途。</p>

<p>service 的宣告方式如下：</p>

<pre><code>app.factory("serviceName", ['requiredServiceName', ... , function(requiredServiceObj, ...){
    ...
}])
</code></pre>

<p>和宣告 Controller 差不多，僅差別於使用的是 factory 這個 API, 而在 function 裡回傳了什麼就決定了這個 service 被 inject 的時候可以得到的東西。</p>

<p>基於這個特性，我們可以用 service 來宣告物件</p>

<pre><code>app.factory("myClassService", [function(){
    function myClass(){ }
    myClass.prototype.constructor = myClass;

    return myClass;
}])
</code></pre>

<p>在不同的 Controller 間分享資料</p>

<pre><code>app.factory("myDataService", [function(){
    return {
        data: [{id: 1, value: "one"}, {id: 5, value: "fifth"}]
    }
}])
</code></pre>

<p>或者包裝複雜的邏輯，例如之前的 AJAX 取資料範例可以改成 service</p>

<pre><code>app.factory("myAjaxService", ['$http', 'q', function($http, $q){
    return {
        get: function(){
            return $q(function(resolve, reject){
                $http.get("urlPath")
                .then(function(result){
                    if (result.data.price &lt;= 0){
                        reject("wrong price, should never be 0 or smaller than 0.")
                    }
                    resolve(result.data.price)
                })
                .catch(function(err){
                    console.log(err)
                    reject(err)
                })
            })
        }
    }
}])

app.controller("myController", ['$scope', 'myAjaxService', function($scope, myAjaxService){
    $scope.qty = 1;
    $scope.cost = myAjaxService.get();
}])
</code></pre>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/nickhsieh/angular-tutorial">Angular-tutorial</a> is maintained by <a href="https://github.com/nickhsieh">nickhsieh</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-70951918-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
